<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç | DP Design</title>
    <link rel="stylesheet" href="style.css"> <!-- –û—Å–Ω–æ–≤–µ–Ω CSS -->

    <style>
        body {
            background-color: #121212;
            color: #fce5cd;
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 500px;
            margin: 50px auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        input, textarea {
            width: 95%;
            padding: 10px;
            margin: 10px auto;
            border: none;
            border-radius: 5px;
        }
        button {
            width: 50%;
            padding: 10px;
            margin-top: 10px;
            border: none;
            border-radius: 5px;
            background-color: #fce5cd;
            color: #000;
            font-weight: bold;
            cursor: pointer;
        }
        button:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>

    <div id="header"></div> <!-- –î–∏–Ω–∞–º–∏—á–µ–Ω —Ö–µ–¥—ä—Ä -->

    <div class="container">
        <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç</h2>
        <form id="edit-product-form">
            <input type="hidden" id="product-id">
            <label>–ò–º–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞:</label>
            <input type="text" id="product-name" required>
            
            <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
            <textarea id="product-description" required></textarea>
            
            <label>–¶–µ–Ω–∞:</label>
            <input type="number" id="product-price" required>
            
            <label>–ü—Ä–æ–º–æ—Ü–∏–æ–Ω–∞–ª–Ω–∞ —Ü–µ–Ω–∞:</label>
            <input type="number" id="product-promo-price">

            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
            <input type="text" id="product-category">
            
            <button type="submit">üíæ –ó–∞–ø–∞–∑–∏ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ</button>
        </form>
    </div>

    <div id="footer"></div> <!-- –î–∏–Ω–∞–º–∏—á–µ–Ω —Ñ—É—Ç—ä—Ä -->

    <script src="script.js" defer></script>
    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get("id");

            if (!productId) {
                alert("‚ùå –õ–∏–ø—Å–≤–∞ ID –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞.");
                window.location.href = "admin.html";
                return;
            }

            document.getElementById("product-id").value = productId;

            try {
                const response = await fetch(`https://api.dp-design.art/products/${productId}`);
                const product = await response.json();

                document.getElementById("product-name").value = product.name;
                document.getElementById("product-description").value = product.description;
                document.getElementById("product-price").value = product.price;
                document.getElementById("product-promo-price").value = product.promo_price || "";
                document.getElementById("product-category").value = product.category || "";

            } catch (error) {
                console.error("‚ö†Ô∏è –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞:", error);
                alert("‚ùå –ù–µ—É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞.");
                window.location.href = "admin.html";
            }

            document.getElementById("edit-product-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const updatedProduct = {
                    name: document.getElementById("product-name").value,
                    description: document.getElementById("product-description").value,
                    price: document.getElementById("product-price").value,
                    promo_price: document.getElementById("product-promo-price").value || null,
                    category: document.getElementById("product-category").value || null
                };

                try {
                    const response = await fetch(`https://api.dp-design.art/products/${productId}`, {
                        method: "PUT",
                        headers: {
                            "Authorization": `Bearer ${localStorage.getItem("token")}`,
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify(updatedProduct)
                    });

                    if (response.ok) {
                        alert("‚úÖ –ü—Ä–æ–¥—É–∫—Ç—ä—Ç –µ –æ–±–Ω–æ–≤–µ–Ω —É—Å–ø–µ—à–Ω–æ!");
                        window.location.href = "admin.html";
                    } else {
                        alert("‚ùå –ù–µ—É—Å–ø–µ—à–Ω–∞ –ø—Ä–æ–º—è–Ω–∞.");
                    }
                } catch (error) {
                    console.error("‚ö†Ô∏è –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–≤–∞–Ω–µ—Ç–æ:", error);
                    alert("‚ùå –í—ä–∑–Ω–∏–∫–Ω–∞ –ø—Ä–æ–±–ª–µ–º.");
                }
            });
        });
    </script>

</body>
</html>
