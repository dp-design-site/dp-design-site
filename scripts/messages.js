function loadMessages() {
    console.log("üì® –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å—ä–æ–±—â–µ–Ω–∏—è...");

    const tableBody = document.getElementById("messages-table-body");
    const noMessages = document.getElementById("no-messages");

    fetch("https://api.dp-design.art/api/messages")
        .then(response => {
            if (!response.ok) throw new Error("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ —Å—ä–æ–±—â–µ–Ω–∏—è");
            return response.json();
        })
        .then(messages => {
            if (!messages || messages.length === 0) {
                noMessages.textContent = "‚ùå –ù—è–º–∞ —Å—ä–æ–±—â–µ–Ω–∏—è.";
                return;
            }

            tableBody.innerHTML = "";

            messages.forEach((msg) => {
                const row = document.createElement("tr");

                if (!msg.is_read) row.classList.add("unread");

                row.innerHTML = `
                    <td>${msg.name || "‚Äî"}</td>
                    <td>${msg.email || "‚Äî"}</td>
                    <td>${msg.type}</td>
                    <td>${new Date(msg.created_at).toLocaleString("bg-BG")}</td>
                    <td>${msg.is_read ? "–ü—Ä–æ—á–µ—Ç–µ–Ω–æ" : "–ù–µ–ø—Ä–æ—á–µ—Ç–µ–Ω–æ"}</td>
                    <td class="actions">
                        <button class="view-btn" data-id="${msg.id}">üëÅÔ∏è –í–∏–∂</button>
                    </td>
                `;

                row.querySelector(".view-btn").addEventListener("click", async () => {
                    alert(`üì¨ –°—ä–æ–±—â–µ–Ω–∏–µ –æ—Ç ${msg.name}\n\n${msg.message || "‚Äî"}`);

                    if (!msg.is_read) {
                        await markAsRead(msg.id);
                        row.classList.remove("unread");
                        row.querySelector("td:nth-child(5)").textContent = "–ü—Ä–æ—á–µ—Ç–µ–Ω–æ";
                    }
                });

                tableBody.appendChild(row);
            });
        })
        .catch(error => {
            console.error("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å—ä–æ–±—â–µ–Ω–∏—è:", error);
            noMessages.textContent = "‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ.";
        });
}

async function markAsRead(id) {
    try {
        await fetch(`https://api.dp-design.art/api/messages/${id}/read`, {
            method: "PATCH",
            headers: { "Content-Type": "application/json" },
        });
        console.log(`‚úÖ –°—ä–æ–±—â–µ–Ω–∏–µ ${id} –µ –º–∞—Ä–∫–∏—Ä–∞–Ω–æ –∫–∞—Ç–æ –ø—Ä–æ—á–µ—Ç–µ–Ω–æ`);
    } catch (err) {
        console.error("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ PATCH:", err);
    }
}
