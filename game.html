<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>–•–≤–∞–Ω–∏ –∂–∏–≤–æ—Ç–∏–Ω–∫–∞—Ç–∞ üêæ</title>
  <style>
    :root { --bg:#8fd3ff; --text:#083c5a; }
    [hidden] { display:none!important; }
    *{box-sizing:border-box;}
    body{margin:0;overflow:hidden;height:100vh;background:var(--bg);font-family:sans-serif;touch-action:manipulation;}
    #hud{position:fixed;top:12px;left:12px;z-index:3;background:rgba(255,255,255,.6);padding:8px 12px;border-radius:12px;display:flex;gap:12px;align-items:center;}
    #score{font-size:18px;font-weight:700;color:var(--text);}
    #timer{font-size:18px;color:var(--text);}
    #stopBtn,#soundBtn{border:0;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer;}
    #soundBtn{background:#0ea5e9;color:#fff;}
    #stopBtn{background:#ef4444;color:#fff;}
    .overlay{position:fixed;inset:0;z-index:4;display:grid;place-items:center;background:rgba(0,0,0,.3);backdrop-filter:blur(3px);}
    .card{background:#fff;padding:20px;border-radius:16px;width:min(90vw,500px);max-height:90vh;overflow:auto;text-align:center;}
    fieldset{margin:10px 0;padding:10px;border-radius:10px;}
    .btn{margin-top:10px;padding:12px 16px;font-size:20px;border:0;border-radius:10px;background:#16a34a;color:#fff;cursor:pointer;}
    .animal{position:absolute;width:80px;height:80px;display:grid;place-items:center;border-radius:50%;background:rgba(255,255,255,.7);animation:floatUp linear forwards;cursor:pointer;}
    .animal.big{width:120px;height:120px;border:4px solid #f59e0b;}
    .emoji{font-size:40px;}
    .animal.big .emoji{font-size:60px;}
    @keyframes floatUp{from{transform:translateY(105vh);}to{transform:translateY(-120px);}}
    .boss{position:absolute;width:160px;height:160px;display:grid;place-items:center;border-radius:20px;background:#ffd369;border:5px solid #ef4444;box-shadow:0 6px 16px rgba(0,0,0,.4);}
    .boss .emoji{font-size:100px;}
    .boss .hp{position:absolute;bottom:8px;left:50%;transform:translateX(-50%);width:80%;height:12px;background:#fecaca;border-radius:12px;overflow:hidden;}
    .boss .bar{height:100%;width:100%;background:linear-gradient(90deg,#16a34a,#4ade80);}
    .pop{position:absolute;font-size:28px;animation:popfade .7s forwards;pointer-events:none;}
    @keyframes popfade{0%{transform:translate(-50%,-50%) scale(.8);opacity:1;}100%{transform:translate(-50%,-120%) scale(1.3);opacity:0;}}
  </style>
</head>
<body>
  <div id="hud">
    <span id="score">–¢–æ—á–∫–∏: 0</span>
    <span id="timer" hidden>‚è±</span>
    <button id="soundBtn">üîä</button>
    <button id="stopBtn" hidden>üõë –°—Ç–æ–ø</button>
  </div>

  <!-- —Å—Ç–∞—Ä—Ç–æ–≤ –µ–∫—Ä–∞–Ω -->
  <div id="startOverlay" class="overlay">
    <div class="card">
      <h2>–•–≤–∞–Ω–∏ –∂–∏–≤–æ—Ç–∏–Ω–∫–∞—Ç–∞ üê∂üê±</h2>
      <fieldset>
        <legend>–¢—Ä—É–¥–Ω–æ—Å—Ç</legend>
        <label><input type="radio" name="level" value="easy" checked> –õ–µ—Å–Ω–æ</label><br>
        <label><input type="radio" name="level" value="medium"> –°—Ä–µ–¥–Ω–æ</label><br>
        <label><input type="radio" name="level" value="hard"> –¢—Ä—É–¥–Ω–æ</label>
      </fieldset>
      <fieldset>
        <legend>–†–µ–∂–∏–º</legend>
        <label><input type="radio" name="mode" value="timed" checked> 30 —Å–µ–∫—É–Ω–¥–∏</label><br>
        <label><input type="radio" name="mode" value="endless"> –ë–µ–∑–∫—Ä–∞–µ–Ω</label>
      </fieldset>
      <fieldset>
        <legend>–û–ø—Ü–∏–∏</legend>
        <label><input type="checkbox" id="bigAnimal"> –ì–æ–ª—è–º–æ –∂–∏–≤–æ—Ç–Ω–æ</label><br>
        <label><input type="checkbox" id="bossToggle" checked> –ë–æ—Å</label>
      </fieldset>
      <button id="startBtn" class="btn">–°—Ç–∞—Ä—Ç ‚ñ∂Ô∏è</button>
    </div>
  </div>

  <!-- —Ñ–∏–Ω–∞–ª -->
  <div id="finalOverlay" class="overlay" hidden>
    <div class="card">
      <h2>–ö—Ä–∞–π üéâ</h2>
      <p id="finalScore"></p>
      <p id="bestScore"></p>
      <button id="playAgain" class="btn">–ò–≥—Ä–∞–π –ø–∞–∫</button>
    </div>
  </div>

  <script>
  let score=0,spawnTimer=null,bigTimer=null,timerUI=null,bossRAF=null;
  let audioCtx=null,soundOn=true,mode="timed",level="easy",curCfg=null,roundEnd=0;
  let bossActive=false,bossEl=null,bossHP=0,nextLevelAt=20;

  const scoreEl=document.getElementById("score"),timerEl=document.getElementById("timer");
  const startOverlay=document.getElementById("startOverlay"),finalOverlay=document.getElementById("finalOverlay");
  const soundBtn=document.getElementById("soundBtn"),stopBtn=document.getElementById("stopBtn");
  const bigAnimalChk=document.getElementById("bigAnimal"),bossToggle=document.getElementById("bossToggle");
  const finalScore=document.getElementById("finalScore"),bestScore=document.getElementById("bestScore");

  const ANIMALS=["üê∂","üê±","üêπ","üê∞","ü¶ä","üêª","üêº","üê®","üê∑","üêµ","üê∏","üê•","ü¶Ñ"];
  const BIG_ANIMALS=["ü¶Å","üêò","ü¶í","üê≥","ü¶à"];
  const BOSS=["üê≤","ü¶ñ","üêâ","ü¶ç"];

  const LEVELS={
    easy:{interval:1100,speedMin:5.5,speedMax:8,per:()=>1},
    medium:{interval:850,speedMin:4.5,speedMax:7,per:()=>Math.random()<0.6?2:1},
    hard:{interval:650,speedMin:3.5,speedMax:5.5,per:()=>Math.random()<0.5?2:3}
  };

  function rand(a,b){return Math.random()*(b-a)+a;}
  function ensureAudio(){if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();}
  function playPop(mult=1){if(!soundOn)return;ensureAudio();if(!audioCtx)return;const o=audioCtx.createOscillator(),g=audioCtx.createGain(),now=audioCtx.currentTime;o.type="triangle";o.frequency.value=mult>1?520:820;g.gain.setValueAtTime(.2,now);g.gain.exponentialRampToValueAtTime(.001,now+.1);o.connect(g).connect(audioCtx.destination);o.start(now);o.stop(now+.12);}
  soundBtn.onclick=()=>{soundOn=!soundOn;soundBtn.textContent=soundOn?"üîä":"üîà";};

  function popFx(x,y,t){const d=document.createElement("div");d.className="pop";d.textContent=t;d.style.left=x+"px";d.style.top=y+"px";document.body.appendChild(d);setTimeout(()=>d.remove(),700);}
  function makeAnimal(big,cfg){const d=document.createElement("div");d.className=big?"animal big":"animal";d.style.left=rand(0,window.innerWidth-100)+"px";d.style.animationDuration=rand(cfg.speedMin,cfg.speedMax)+"s";const e=document.createElement("span");e.className="emoji";e.textContent=big?BIG_ANIMALS[Math.floor(Math.random()*BIG_ANIMALS.length)]:ANIMALS[Math.floor(Math.random()*ANIMALS.length)];d.appendChild(e);d.onclick=ev=>catchAnimal(ev,d,big?5:1);document.body.appendChild(d);setTimeout(()=>d.remove(),8000);}
  function catchAnimal(ev,el,pts){if(!el.isConnected)return;score+=pts;scoreEl.textContent="–¢–æ—á–∫–∏: "+score;playPop(pts>1?1.4:1);const r=el.getBoundingClientRect();popFx(ev.clientX||r.left,r.top,pts>1?`+${pts}`:"+1");el.remove();if(mode==="endless") adjust();}
  function tick(){if(bossActive)return;for(let i=0;i<curCfg.per();i++)makeAnimal(false,curCfg);}
  function adjust(){const steps=Math.floor(score/20),base=LEVELS[level];curCfg={...base,interval:Math.max(base.interval-steps*80,400)};clearInterval(spawnTimer);spawnTimer=setInterval(tick,curCfg.interval);if(bossToggle.checked&&score>=nextLevelAt){spawnBoss();nextLevelAt+=20;}}
  function startBig(en){if(bigTimer)clearInterval(bigTimer);if(!en)return;bigTimer=setInterval(()=>makeAnimal(true,curCfg),10000);}
  function clearAll(){document.querySelectorAll(".animal,.boss,.pop").forEach(n=>n.remove());bossActive=false;bossEl=null;cancelAnimationFrame(bossRAF);}
  // –±–æ—Å
  function spawnBoss(){if(bossActive)return;bossActive=true;bossHP=6;bossEl=document.createElement("div");bossEl.className="boss";const em=document.createElement("div");em.className="emoji";em.textContent=BOSS[Math.floor(Math.random()*BOSS.length)];const hp=document.createElement("div");hp.className="hp";const bar=document.createElement("div");bar.className="bar";hp.appendChild(bar);bossEl.appendChild(em);bossEl.appendChild(hp);document.body.appendChild(bossEl);let x=100,y=window.innerHeight-200,vx=2;function loop(){x+=vx;if(x<0||x>window.innerWidth-160)vx*=-1;bossEl.style.transform=`translate(${x}px,${y}px)`;if(bossActive)bossRAF=requestAnimationFrame(loop);}loop();bossEl.onclick=()=>{bossHP--;navigator.vibrate?.(80);bossEl.style.transform+=" scale(0.9)";setTimeout(()=>bossEl.style.transform= bossEl.style.transform.replace(" scale(0.9)",""),150);bar.style.width=(bossHP/6*100)+"%";if(bossHP<=0){score+=10;scoreEl.textContent="–¢–æ—á–∫–∏: "+score;bossEl.remove();bossActive=false;}};}
  // start
  function startGame(){level=document.querySelector("input[name=level]:checked").value;mode=document.querySelector("input[name=mode]:checked").value;curCfg={...LEVELS[level]};score=0;scoreEl.textContent="–¢–æ—á–∫–∏: 0";startOverlay.hidden=true;finalOverlay.hidden=true;stopBtn.hidden=(mode!=="endless");clearAll();tick();spawnTimer=setInterval(tick,curCfg.interval);startBig(bigAnimalChk.checked);if(mode==="timed"){roundEnd=performance.now()+30000;timerEl.hidden=false;timerUI=setInterval(()=>{let left=roundEnd-performance.now();timerEl.textContent="‚è± "+(left/1000).toFixed(1);if(bossToggle.checked&&left<6000&&!bossActive)spawnBoss();if(left<=0){endGame();showFinal();}},100);}else timerEl.hidden=true;}
  function endGame(){clearInterval(spawnTimer);clearInterval(bigTimer);clearInterval(timerUI);clearAll();}
  function showFinal(){finalScore.textContent="–¢–æ—á–∫–∏: "+score;const key="best_"+mode;let best=localStorage.getItem(key)||0;if(score>best){best=score;localStorage.setItem(key,score);}bestScore.textContent="–†–µ–∫–æ—Ä–¥: "+best;finalOverlay.hidden=false;}
  // –±—É—Ç–æ–Ω–∏
  document.getElementById("startBtn").onclick=startGame;
  document.getElementById("playAgain").onclick=()=>{finalOverlay.hidden=true;startGame();};
  stopBtn.onclick=()=>{endGame();showFinal();};
  </script>
</body>
</html>
