<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–•–≤–∞–Ω–∏ –∂–∏–≤–æ—Ç–∏–Ω–∫–∞—Ç–∞ üêæ</title>
  <style>
    :root { --bg:#8fd3ff; --text:#083c5a; }
    * { box-sizing: border-box; }
    html, body { height:100%; }
    body {
      margin:0; overflow:hidden; background:var(--bg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      touch-action: manipulation; /* –ø–æ-–¥–æ–±—Ä–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª–Ω–∏ */
    }
    #hud {
      position: fixed; inset: 12px auto auto 12px;
      z-index: 3; color: var(--text); font-weight: 700;
      background: rgba(255,255,255,.6); padding: 8px 12px; border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,.15);
      user-select: none;
    }
    #score { font-size: 20px; }
    #startOverlay {
      position: fixed; inset: 0; z-index: 4; display: grid; place-items: center;
      background: linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.15));
      backdrop-filter: blur(3px);
    }
    #startCard {
      background: white; padding: 22px 24px; border-radius: 16px; text-align: center;
      width: min(90vw, 440px); box-shadow: 0 12px 30px rgba(0,0,0,.25);
      color:#123;
    }
    #startCard h1 { margin: 0 0 6px; font-size: 26px; }
    #startCard p { margin: 0 0 16px; }
    #startBtn {
      font-size: 20px; padding: 12px 18px; border-radius: 12px; border: 0;
      background: #16a34a; color: white; cursor: pointer; width: 100%;
    }
    #startBtn:active { transform: scale(.98); }

    .animal {
      position: absolute; width: clamp(72px, 8vw, 96px); height: clamp(72px, 8vw, 96px);
      display: grid; place-items: center; border-radius: 50%;
      background: rgba(255,255,255,.7); box-shadow: 0 6px 16px rgba(0,0,0,.2);
      user-select: none; -webkit-user-drag: none;
      touch-action: none; /* –¥–∞ —Ö–≤–∞—â–∞ —Ç–æ—á–Ω–æ —Ç–∞–ø–æ–≤–µ—Ç–µ */
      animation: floatUp linear forwards;
      cursor: pointer;
      z-index: 2;
    }
    .emoji {
      font-size: clamp(42px, 6vw, 56px); line-height: 1;
      transform: translateY(2px);
    }

    @keyframes floatUp {
      from { transform: translateY(105vh) rotate(0deg); opacity: .98; }
      to   { transform: translateY(-120px) rotate(6deg); opacity: 1; }
    }

    .pop {
      position: absolute; pointer-events: none; z-index: 5;
      font-size: 28px; animation: popfade 700ms ease-out forwards;
    }
    @keyframes popfade {
      0% { transform: translate(-50%,-50%) scale(.8); opacity: 1; }
      100% { transform: translate(-50%,-120%) scale(1.3); opacity: 0; }
    }
  </style>
</head>
<body>
  <div id="hud"><span id="score">–¢–æ—á–∫–∏: 0</span></div>

  <div id="startOverlay" role="dialog" aria-modal="true">
    <div id="startCard">
      <h1>–•–≤–∞–Ω–∏ –∂–∏–≤–æ—Ç–∏–Ω–∫–∞—Ç–∞ üê∂üê±</h1>
      <p>–ü—É–∫–∞–π –∂–∏–≤–æ—Ç–∏–Ω–∫–∏ —Å –∫–ª–∏–∫/—Ç–∞–ø. –ë–µ–∑ —Ç–∞–π–º–µ—Ä, —Å–∞–º–æ –∑–∞–±–∞–≤–ª–µ–Ω–∏–µ.</p>
      <button id="startBtn">–°—Ç–∞—Ä—Ç ‚ñ∂Ô∏è</button>
    </div>
  </div>

  <!-- –ú–∞–ª—ä–∫ ‚Äû–ø–æ–ø‚Äú –∑–≤—É–∫, —â–µ —Å–µ —Å—Ç–∞—Ä—Ç–∏—Ä–∞ —Å–ª–µ–¥ –ø—ä—Ä–≤–∏—è –∫–ª–∏–∫ –Ω–∞ Start -->
  <audio id="popSound" preload="auto">
    <source src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAA... (short)" type="audio/mpeg">
  </audio>

  <script>
    // –∞–∫–æ data: –µ —Ç–≤—ä—Ä–¥–µ –¥—ä–ª–≥–∞ –∑–∞ –Ω—è–∫–æ–∏ –±—Ä–∞—É–∑—ä—Ä–∏, —â–µ –≥–µ–Ω–µ—Ä–∏—Ä–∞–º–µ –∑–≤—É–∫ —Å WebAudio fallback
    let score = 0;
    const scoreEl = document.getElementById('score');
    const popEl = document.getElementById('popSound');
    const startOverlay = document.getElementById('startOverlay');
    const startBtn = document.getElementById('startBtn');

    // –ï–º–æ–¥–∂–∏ ‚Äû–∂–∏–≤–æ—Ç–∏–Ω–∫–∏‚Äú ‚Äì –ª–µ—Å–Ω–∏ –∑–∞ 4-5 –≥–æ–¥–∏—à–Ω–∏, –≥–æ–ª–µ–º–∏ –∏ —Ü–≤–µ—Ç–Ω–∏
    const ANIMALS = ["üê∂","üê±","üêπ","üê∞","ü¶ä","üêª","üêº","üê®","üê∑","üêµ","üê∏","üê•","ü¶Ñ"];
    const COLORS = [
      "rgba(255,255,255,.8)", "rgba(255,240,200,.85)",
      "rgba(225,255,225,.85)", "rgba(225,240,255,.85)"
    ];

    let spawnTimer = null;
    let audioCtx = null;

    function safePlayPop() {
      // –ü—ä—Ä–≤–æ –æ–ø–∏—Ç —Å <audio>, –∞–∫–æ –Ω–µ ‚Äì WebAudio –∫—Ä–∞—Ç—ä–∫ ‚Äû–ø–æ–ø‚Äú
      const tried = popEl.play?.();
      if (tried && typeof tried.then === 'function') {
        tried.catch(() => beep());
      } else {
        beep();
      }
    }

    function beep() {
      try {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = "triangle";
        o.frequency.value = 820; // –∫—Ä–∞—Ç—ä–∫ –ø–∏—Å—É–∫
        g.gain.value = 0.00001;
        o.connect(g); g.connect(audioCtx.destination);
        o.start();
        // –º–∞–ª—ä–∫ ‚Äû–ø–æ–ø‚Äú ‚Äì –±—ä—Ä–∑ attack/release
        g.gain.exponentialRampToValueAtTime(0.2, audioCtx.currentTime + 0.01);
        g.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.08);
        o.stop(audioCtx.currentTime + 0.09);
      } catch {}
    }

    function rand(min, max) { return Math.random() * (max - min) + min; }

    function spawnAnimal() {
      const d = document.createElement('div');
      d.className = 'animal';
      d.style.left = `${rand(0, Math.max(0, window.innerWidth - 100))}px`;
      d.style.background = COLORS[Math.floor(Math.random()*COLORS.length)];
      // –ü—Ä–æ–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ—Å—Ç –Ω–∞ –∏–∑–¥–∏–≥–∞–Ω–µ—Ç–æ ‚Äì –º–∞–ª–∫–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ
      const dur = rand(4.5, 7.5).toFixed(2);
      d.style.animationDuration = `${dur}s`;

      const span = document.createElement('span');
      span.className = 'emoji';
      span.textContent = ANIMALS[Math.floor(Math.random()*ANIMALS.length)];
      d.appendChild(span);

      // –ù–∞–¥—É–≤–∞–Ω–µ/—Å–º–∞–ª—è–≤–∞–Ω–µ –∑–∞ –∑–∞–∫–∞—á–ª–∏–≤ –µ—Ñ–µ–∫—Ç –ø—Ä–∏ –ø–æ—è–≤—è–≤–∞–Ω–µ
      d.animate([{transform:"translateY(105vh) scale(.9)"},{transform:"translateY(105vh) scale(1)"}],
                {duration:250, easing:"ease-out"});

      // –£–Ω–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–æ –∑–∞ –∫–ª–∏–∫/—Ç–∞–ø: pointerdown
      d.addEventListener('pointerdown', (ev) => {
        catchAnimal(ev, d);
      }, { passive: true });

      document.body.appendChild(d);

      // –ê–≤—Ç–æ-–ø—Ä–µ–º–∞—Ö–≤–∞–Ω–µ —Å–ª–µ–¥ –∞–Ω–∏–º–∞—Ü–∏—è—Ç–∞ (–∞–∫–æ –Ω–µ –µ —Ö–≤–∞–Ω–∞—Ç–æ)
      const ttl = parseFloat(dur) * 1000 + 200;
      setTimeout(() => d.remove(), ttl);
    }

    function catchAnimal(ev, elem) {
      if (!elem.isConnected) return;
      score++;
      scoreEl.textContent = "–¢–æ—á–∫–∏: " + score;
      safePlayPop();

      // –º–∞–ª–∫–∞ ‚Äû–ø–æ–ø‚Äú –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
      const fx = document.createElement('div');
      fx.className = 'pop';
      fx.textContent = "+1";
      fx.style.left = (ev.clientX || (elem.getBoundingClientRect().left + elem.offsetWidth/2)) + "px";
      fx.style.top  = (ev.clientY || (elem.getBoundingClientRect().top + elem.offsetHeight/2)) + "px";
      document.body.appendChild(fx);
      setTimeout(() => fx.remove(), 800);

      // –ø—Ä–µ–º–∞—Ö–Ω–∏ –∂–∏–≤–æ—Ç–∏–Ω–∫–∞—Ç–∞
      elem.remove();
    }

    function startGame() {
      // –æ—Ç–∫–ª—é—á–≤–∞–Ω–µ –Ω–∞ –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å (–∑–∞ iOS/Android –ø–æ–ª–∏—Ç–∏–∫–∏)
      try {
        popEl.currentTime = 0;
        popEl.play().catch(()=>{}); // best effort
      } catch {}
      if (!audioCtx) {
        try { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
        catch {}
      }

      startOverlay.style.display = 'none';
      score = 0;
      scoreEl.textContent = "–¢–æ—á–∫–∏: 0";

      // –ø—ä—Ä–≤–∏ —Å–ø–∞—É–Ω –≤–µ–¥–Ω–∞–≥–∞, –ø–æ—Å–ª–µ –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ
      spawnAnimal();
      if (spawnTimer) clearInterval(spawnTimer);
      spawnTimer = setInterval(() => spawnAnimal(), 900);

      // –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫—ä–º resize (–±–µ–∑ –¥–∞ —Å–ø–∏—Ä–∞ –∏–≥—Ä–∞—Ç–∞)
      window.addEventListener('resize', () => {}, { passive: true });
    }

    startBtn.addEventListener('click', startGame, { passive: true });

    // –ó–∞ –≤—Å–µ–∫–∏ —Å–ª—É—á–∞–π: –ø–æ–∑–≤–æ–ª–∏ ‚Äû–∫–ª–∏–∫‚Äú –ø–æ —Ü–µ–ª–∏—è –µ–∫—Ä–∞–Ω –¥–∞ —Ö–≤–∞–Ω–µ –∂–∏–≤–æ—Ç–∏–Ω–∫–∞,
    // –∞–∫–æ —Ç–∞–ø—ä—Ç –µ –≤—ä—Ä—Ö—É –µ–º–æ–¥–∂–∏—Ç–æ (closest –¥–æ .animal)
    document.addEventListener('pointerdown', (ev) => {
      const target = ev.target.closest?.('.animal');
      if (target) catchAnimal(ev, target);
    }, { passive: true });
  </script>
</body>
</html>
