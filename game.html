<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Ğ¥Ğ²Ğ°Ğ½Ğ¸ Ñ„Ğ¸Ğ³ÑƒÑ€ĞºĞ°Ñ‚Ğ° ğŸ®</title>
<style>
  body{margin:0;overflow:hidden;background:#8fd3ff;font-family:Arial,Helvetica,sans-serif;touch-action:manipulation;}
  [hidden]{display:none!important;}

  /* HUD */
  #hud{position:fixed;top:8px;left:8px;z-index:3;background:rgba(255,255,255,.7);padding:6px 10px;border-radius:12px;display:flex;gap:8px;align-items:center}
  #hud span{font-weight:700;color:#083c5a}
  #soundBtn,#stopBtn,#homeBtn{border:0;padding:6px 10px;border-radius:8px;font-weight:700;cursor:pointer}
  #soundBtn{background:#0ea5e9;color:#fff}
  #stopBtn{background:#ef4444;color:#fff}
  #homeBtn{position:fixed;top:8px;right:8px;z-index:4;background:#16a34a;color:#fff}

  /* ĞĞ²ĞµÑ€Ğ»ĞµĞ¸ (Ğ±ĞµĞ· blur â€“ Ğ·Ğ° ÑÑ‚Ğ°Ñ€Ğ¸Ñ‚Ğµ WebView) */
  .overlay{position:fixed;left:0;top:0;right:0;bottom:0;z-index:5;display:grid;place-items:center;background:rgba(0,0,0,.35);padding:10px;overflow:auto;min-height:100vh}
  @supports (height:100dvh){.overlay{min-height:100dvh}}
  .card{background:#fff;padding:18px;border-radius:16px;width:min(92vw,520px);max-height:92vh;overflow:auto;text-align:center;box-shadow:0 12px 30px rgba(0,0,0,.25)}
  fieldset{margin:10px 0;padding:10px;border-radius:10px;border:1px solid #e5e7eb;text-align:left}
  legend{padding:0 6px;font-weight:700}
  .btn{margin-top:10px;padding:12px 16px;font-size:18px;border:0;border-radius:10px;background:#16a34a;color:#fff;cursor:pointer}

  /* Ğ¤Ğ¸Ğ³ÑƒÑ€ĞºĞ¸ â€“ Ñ†ĞµĞ½Ñ‚Ñ€Ğ¾Ğ²ĞºĞ° Ñ‡Ñ€ĞµĞ· flex; Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Ñ transition (Ğ¿Ğ¸ĞºÑĞµĞ»Ğ¸) */
  .animal{
    position:absolute;width:80px;height:80px;border-radius:50%;
    background:#ffffffcc;box-shadow:0 6px 16px rgba(0,0,0,.2);cursor:pointer;
    display:flex;align-items:center;justify-content:center;
    transform:translate(0,0);transition:transform linear; /* duration Ğ¿Ğ¾ JS */
  }
  .animal.big{width:120px;height:120px;border:4px solid #f59e0b}
  .emoji{display:block;font-size:40px;line-height:1}
  .animal.big .emoji{font-size:60px}

  /* Ğ‘Ğ¾Ñ */
  .boss{position:absolute;width:160px;height:160px;display:flex;align-items:center;justify-content:center;border-radius:20px;background:#ffd369;border:5px solid #ef4444;box-shadow:0 6px 16px rgba(0,0,0,.4)}
  .boss .emoji{font-size:100px;line-height:1}
  .boss .hp{position:absolute;bottom:8px;left:50%;transform:translateX(-50%);width:80%;height:12px;background:#fecaca;border-radius:12px;overflow:hidden}
  .boss .bar{height:100%;width:100%;background:linear-gradient(90deg,#16a34a,#4ade80)}

  /* ĞŸĞ¾Ğ¿ ĞµÑ„ĞµĞºÑ‚ */
  .pop{position:absolute;font-size:28px;pointer-events:none;animation:popfade .7s ease-out forwards}
  @keyframes popfade{0%{transform:translate(-50%,-50%) scale(.8);opacity:1}100%{transform:translate(-50%,-120%) scale(1.3);opacity:0}}

  @media (max-height:600px){ .card{padding:14px;max-height:95vh} .btn{padding:10px 12px;font-size:16px} }
</style>
</head>
<body>
  <div id="hud">
    <span id="score">Ğ¢Ğ¾Ñ‡ĞºĞ¸: 0</span>
    <span id="timer" hidden>â±</span>
    <button id="soundBtn" title="Ğ—Ğ²ÑƒĞº">ğŸ”Š</button>
    <button id="stopBtn" hidden title="Ğ¡Ñ‚Ğ¾Ğ¿">ğŸ›‘</button>
  </div>
  <button id="homeBtn" title="ĞĞ°Ñ‡Ğ°Ğ»Ğ¾">ğŸ </button>

  <!-- Ğ¡Ñ‚Ğ°Ñ€Ñ‚ -->
  <div id="startOverlay" class="overlay">
    <div class="card">
      <h2>Ğ¥Ğ²Ğ°Ğ½Ğ¸ Ñ„Ğ¸Ğ³ÑƒÑ€ĞºĞ°Ñ‚Ğ° ğŸ®</h2>
      <fieldset>
        <legend>Ğ¢ĞµĞ¼Ğ°</legend>
        <label><input type="radio" name="theme" value="animals" checked> Ğ–Ğ¸Ğ²Ğ¾Ñ‚Ğ½Ğ¸</label><br>
        <label><input type="radio" name="theme" value="balloons"> Ğ‘Ğ°Ğ»Ğ¾Ğ½Ğ¸</label><br>
        <label><input type="radio" name="theme" value="cars"> ĞšĞ¾Ğ»Ğ¸</label>
      </fieldset>
      <fieldset>
        <legend>Ğ¢Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚</legend>
        <label><input type="radio" name="level" value="easy" checked> Ğ›ĞµÑĞ½Ğ¾</label><br>
        <label><input type="radio" name="level" value="medium"> Ğ¡Ñ€ĞµĞ´Ğ½Ğ¾</label><br>
        <label><input type="radio" name="level" value="hard"> Ğ¢Ñ€ÑƒĞ´Ğ½Ğ¾</label>
      </fieldset>
      <fieldset>
        <legend>Ğ ĞµĞ¶Ğ¸Ğ¼</legend>
        <label><input type="radio" name="mode" value="timed" checked> 30 ÑĞµĞºÑƒĞ½Ğ´Ğ¸</label><br>
        <label><input type="radio" name="mode" value="endless"> Ğ‘ĞµĞ·ĞºÑ€Ğ°ĞµĞ½</label>
      </fieldset>
      <fieldset>
        <legend>ĞĞ¿Ñ†Ğ¸Ğ¸</legend>
        <label><input type="checkbox" id="bigAnimal"> Ğ“Ğ¾Ğ»ÑĞ¼Ğ¾</label><br>
        <label><input type="checkbox" id="bossToggle" checked> Ğ‘Ğ¾Ñ</label>
      </fieldset>
      <button id="startBtn" class="btn">Ğ¡Ñ‚Ğ°Ñ€Ñ‚ â–¶ï¸</button>
    </div>
  </div>

  <!-- Ğ¤Ğ¸Ğ½Ğ°Ğ» -->
  <div id="finalOverlay" class="overlay" hidden>
    <div class="card">
      <h2>ĞšÑ€Ğ°Ğ¹ ğŸ‰</h2>
      <p id="finalScore"></p>
      <p id="bestScore"></p>
      <button id="playAgain" class="btn">Ğ˜Ğ³Ñ€Ğ°Ğ¹ Ğ¿Ğ°Ğº</button>
      <button id="backHome" class="btn">ĞĞ°Ñ‡Ğ°Ğ»Ğ¾</button>
    </div>
  </div>

<script>
/* ===== Ğ¡ĞªĞ¡Ğ¢ĞĞ¯ĞĞ˜Ğ• (ES5) ===== */
var score=0, spawnTimer=null, bigTimer=null, timerUI=null, bossRAF=null;
var audioCtx=null, soundOn=true, mode="timed", level="easy", curCfg=null, roundEnd=0;
var bossActive=false, bossEl=null, bossHP=0, nextLevelAt=20;
var theme="animals", THEME={small:[], big:[]}, SAFE_MODE=false;

/* ===== UI refs ===== */
var scoreEl=document.getElementById("score"),
    timerEl=document.getElementById("timer"),
    startOverlay=document.getElementById("startOverlay"),
    finalOverlay=document.getElementById("finalOverlay"),
    soundBtn=document.getElementById("soundBtn"),
    stopBtn=document.getElementById("stopBtn"),
    homeBtn=document.getElementById("homeBtn"),
    bigAnimalChk=document.getElementById("bigAnimal"),
    bossToggle=document.getElementById("bossToggle"),
    finalScore=document.getElementById("finalScore"),
    bestScore=document.getElementById("bestScore");

/* ===== Ğ”Ğ°Ğ½Ğ½Ğ¸ ===== */
var THEMES_MAIN={
  animals:{small:["ğŸ¶","ğŸ±","ğŸ¹","ğŸ°","ğŸ¦Š","ğŸ»","ğŸ¼","ğŸ¨","ğŸ·","ğŸµ","ğŸ¸","ğŸ¥","ğŸ¦„"],big:["ğŸ¦","ğŸ˜","ğŸ¦’","ğŸ³","ğŸ¦ˆ"]},
  balloons:{small:["ğŸˆ","ğŸ‰","âœ¨","â­","ğŸ’«","ğŸŒˆ"],big:["ğŸ†","ğŸ‡","ğŸŠ"]},
  cars:{small:["ğŸš—","ğŸš™","ğŸš•","ğŸï¸","ğŸš“","ğŸš‘","ğŸš’"],big:["ğŸ›»","ğŸšš","ğŸš›"]}
};
/* â€Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¸â€œ ĞµĞ¼Ğ¾Ğ´Ğ¶Ğ¸Ñ‚Ğ° (Unicode 6.1), Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ½Ğ¸ Ğ½Ğ° Android 4.x */
var THEMES_SAFE={
  animals:{small:["ğŸ¶","ğŸ±","ğŸ­","ğŸ¹","ğŸ°","ğŸ»","ğŸ¨","ğŸ·","ğŸµ","ğŸ¸","ğŸ”","ğŸ™","ğŸŸ"],big:["ğŸ¯","ğŸ˜","ğŸ¬","ğŸ³","ğŸ®"]},
  balloons:{small:["ğŸˆ","â­","âœ¨"],big:["ğŸ†","ğŸ‡","ğŸŠ"]},
  cars:{small:["ğŸš—","ğŸš™","ğŸš•","ğŸš“","ğŸš‘","ğŸš’"],big:["ğŸšš","ğŸš›"]}
};
/* Ğ‘Ğ¾Ñ ĞµĞ¼Ğ¾Ğ´Ğ¶Ğ¸ â€“ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¸ Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¸ */
var BOSS_MAIN=["ğŸ²","ğŸ¦–","ğŸ‰","ğŸ¦"], BOSS_SAFE=["ğŸ²","ğŸ‰","ğŸ’£","ğŸ˜¡"];
var LEVELS={easy:{interval:1100,per:function(){return 1;}},medium:{interval:850,per:function(){return Math.random()<0.6?2:1;}},hard:{interval:650,per:function(){return Math.random()<0.5?2:3;}}};

/* ===== Ğ”ĞµÑ‚ĞµĞºÑ‚ Ğ·Ğ° â€safe modeâ€œ (Android <=4 / Ğ¼Ğ½Ğ¾Ğ³Ğ¾ ÑÑ‚Ğ°Ñ€ Chrome) ===== */
(function(){
  var ua=(navigator.userAgent||"").toLowerCase();
  if(/android 4\./.test(ua) || /chrome\/[0-3]\d\./.test(ua)) SAFE_MODE=true;
})();

/* ===== Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ğ¸ ===== */
function vh() { // ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ĞµĞ½ viewport height
  return Math.max(document.documentElement.clientHeight, window.innerHeight||0);
}
function rand(a,b){return Math.random()*(b-a)+a;}
function ensureAudio(){
  try{
    if(!audioCtx && (window.AudioContext||window.webkitAudioContext)){
      audioCtx=new (window.AudioContext||window.webkitAudioContext)();
    }
  }catch(e){ audioCtx=null; }
}
function playPop(mult){
  if(!soundOn) return;
  ensureAudio(); if(!audioCtx) return;
  var now=audioCtx.currentTime, o=audioCtx.createOscillator(), g=audioCtx.createGain();
  o.type="triangle"; o.frequency.value=(mult&&mult>1)?520:820;
  g.gain.setValueAtTime(0.2,now); g.gain.exponentialRampToValueAtTime(0.001,now+0.1);
  o.connect(g).connect(audioCtx.destination); o.start(now); o.stop(now+0.12);
}
function popFx(x,y,t){
  var d=document.createElement("div"); d.className="pop"; d.textContent=t; d.style.left=x+"px"; d.style.top=y+"px";
  document.body.appendChild(d); setTimeout(function(){d.remove();},700);
}

/* ===== ĞŸĞ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸Ğº: Ğ¸Ğ·ĞºĞ°Ñ‡Ğ²Ğ°Ğ½Ğµ Ğ¾Ñ‚Ğ´Ğ¾Ğ»Ñƒ Ñ transition (Ğ´Ğ²ÑƒÑÑ‚ÑŠĞ¿ĞºĞ¾Ğ²Ğ¾, ÑÑ‚Ğ°Ğ±Ğ¸Ğ»Ğ½Ğ¾) ===== */
function riseFromBottom(node, durationSec){
  var H = vh();
  var x = parseFloat(node.style.left)||0;
  /* 1) Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²ÑĞ¼Ğµ Ğ½Ğ°Ñ‡Ğ°Ğ»ĞµĞ½ transform Ğ‘Ğ•Ğ— transition */
  node.style.transition = "none";
  node.style.transform = "translate("+x+"px,"+(H+30)+"px)";
  /* 2) ÑĞ»ĞµĞ´ 2 ĞºĞ°Ğ´ÑŠÑ€Ğ° Ğ²ĞºĞ»ÑÑ‡Ğ²Ğ°Ğ¼Ğµ transition Ğ¸ Ğ·Ğ°Ğ´Ğ°Ğ²Ğ°Ğ¼Ğµ ĞºÑ€Ğ°Ğ¹Ğ½Ğ° Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ */
  requestAnimationFrame(function(){
    requestAnimationFrame(function(){
      node.style.transition = "transform "+durationSec+"s linear";
      node.style.transform = "translate("+x+"px,-120px)";
    });
  });
}

/* ===== Ğ¤Ğ¸Ğ³ÑƒÑ€ĞºĞ¸ ===== */
function addTapHandlers(el, handler){
  el.addEventListener("click", handler, false);
  el.addEventListener("touchstart", function(e){ handler(e); }, false);
}

function makeAnimal(isBig){
  var d=document.createElement("div");
  d.className=isBig?"animal big":"animal";
  d.style.left = Math.max(0, rand(0, window.innerWidth - (isBig?120:80))) + "px";
  var e=document.createElement("span"); e.className="emoji";
  var pool = isBig ? THEME.big : THEME.small;
  e.textContent = pool[Math.floor(Math.random()*pool.length)];
  d.appendChild(e);
  addTapHandlers(d, function(ev){ catchAnimal(ev,d,isBig?5:1); });
  document.body.appendChild(d);

  var dur = isBig ? 6 : rand(4,7);
  riseFromBottom(d, dur);
  setTimeout(function(){ if(d.parentNode) d.parentNode.removeChild(d); }, (dur*1000)+1000);
}

function catchAnimal(ev,el,pts){
  if(!el || !el.parentNode) return;
  score+=pts; scoreEl.textContent="Ğ¢Ğ¾Ñ‡ĞºĞ¸: "+score; playPop(pts>1?1.3:1);
  var r=el.getBoundingClientRect(); popFx((ev.touches?ev.touches[0].clientX:ev.clientX)||r.left, r.top, "+"+pts);
  el.parentNode.removeChild(el);
  if(mode==="endless" && bossToggle.checked && !bossActive && score>=nextLevelAt){ spawnBoss(); nextLevelAt+=20; }
}

function tick(){ if(!bossActive) for(var i=0;i<curCfg.per();i++) makeAnimal(false); }
function startBig(enabled){ if(bigTimer) clearInterval(bigTimer); if(enabled){ bigTimer=setInterval(function(){ makeAnimal(true); },10000); } }
function clearAll(){
  var nodes=document.querySelectorAll(".animal,.boss,.pop");
  for(var i=0;i<nodes.length;i++) nodes[i].remove();
  bossActive=false; bossEl=null; if(bossRAF) cancelAnimationFrame(bossRAF); bossRAF=null;
}

/* ===== Ğ‘Ğ¾Ñ ===== */
function spawnBoss(){
  if(bossActive) return;
  bossActive=true; bossHP=6;

  bossEl=document.createElement("div"); bossEl.className="boss";
  var em=document.createElement("div"); em.className="emoji";
  var BOSS_POOL = SAFE_MODE ? BOSS_SAFE : BOSS_MAIN;
  em.textContent=BOSS_POOL[Math.floor(Math.random()*BOSS_POOL.length)];
  var hp=document.createElement("div"); hp.className="hp";
  var bar=document.createElement("div"); bar.className="bar"; hp.appendChild(bar);
  bossEl.appendChild(em); bossEl.appendChild(hp); document.body.appendChild(bossEl);

  var x=rand(40, window.innerWidth-200), y=vh()+40, vx=(Math.random()<0.5?-1:1)*rand(1.2,2.2), vy=-2.2, t=0;
  function loop(){
    t+=0.016; x+=vx + Math.sin(t*2.2)*1.5; y+=vy;
    if(x<10 || x>window.innerWidth-170){ vx*=-1; x=Math.max(10, Math.min(x, window.innerWidth-170)); }
    bossEl.style.transform="translate("+x+"px,"+y+"px)";
    if(y<-200 && bossActive){ y=vh()-60; }
    if(bossActive) bossRAF=requestAnimationFrame(loop);
  }
  bossRAF=requestAnimationFrame(loop);

  addTapHandlers(bossEl, function(ev){
    bossHP--;
    if(navigator.vibrate) try{ navigator.vibrate(60); }catch(e){}
    playPop(1.6);
    var touch = ev.touches ? ev.touches[0] : ev;
    popFx(touch.clientX||0, touch.clientY||0, "ğŸ‘Š");
    bar.style.width=(Math.max(0,bossHP)/6*100)+"%";
    bossEl.style.transform += " scale(0.92)";
    setTimeout(function(){ bossEl.style.transform=bossEl.style.transform.replace(" scale(0.92)",""); },120);

    if(bossHP<=0){
      bossActive=false; if(bossRAF) cancelAnimationFrame(bossRAF); bossRAF=null;
      var rr=bossEl.getBoundingClientRect();
      score+=10; scoreEl.textContent="Ğ¢Ğ¾Ñ‡ĞºĞ¸: "+score; popFx(rr.left+80, rr.top+40, "+10");
      bossEl.remove(); bossEl=null;
    }
  });
}

/* ===== Ğ¡Ñ‚Ğ°Ñ€Ñ‚ / ĞšÑ€Ğ°Ğ¹ / Ğ ĞµĞ·ÑƒĞ»Ñ‚Ğ°Ñ‚Ğ¸ ===== */
function startGame(){
  var th=document.querySelector("input[name=theme]:checked"); theme=th?th.value:"animals";
  THEME = SAFE_MODE ? THEMES_SAFE[theme] : THEMES_MAIN[theme];

  var lv=document.querySelector("input[name=level]:checked"); level=lv?lv.value:"easy";
  var md=document.querySelector("input[name=mode]:checked"); mode=md?md.value:"timed";

  curCfg={ interval: LEVELS[level].interval, per: LEVELS[level].per };
  score=0; scoreEl.textContent="Ğ¢Ğ¾Ñ‡ĞºĞ¸: 0";
  startOverlay.hidden=true; finalOverlay.hidden=true;
  stopBtn.hidden=(mode!=="endless");
  nextLevelAt=20;
  clearAll(); tick();
  if(spawnTimer) clearInterval(spawnTimer);
  spawnTimer=setInterval(tick, curCfg.interval);
  startBig(!!bigAnimalChk.checked);

  ensureAudio(); if(audioCtx && audioCtx.state==="suspended"){ try{ audioCtx.resume(); }catch(e){} }

  if(mode==="timed"){
    roundEnd=Date.now()+30000; timerEl.hidden=false;
    if(timerUI) clearInterval(timerUI);
    timerUI=setInterval(function(){
      var left=roundEnd-Date.now();
      timerEl.textContent="â± "+Math.max(0,(left/1000)).toFixed(1);
      if(bossToggle.checked && left<6000 && !bossActive){ spawnBoss(); }
      if(left<=0){ endGame(); showFinal(); }
    },100);
  }else{ timerEl.hidden=true; }
}

function endGame(){
  if(spawnTimer) clearInterval(spawnTimer);
  if(bigTimer) clearInterval(bigTimer);
  if(timerUI) clearInterval(timerUI);
  spawnTimer=bigTimer=timerUI=null;
  clearAll();
}

function showFinal(){
  finalScore.textContent="Ğ¢Ğ¾Ñ‡ĞºĞ¸: "+score;
  var key="best_"+mode+"_"+theme, best=Number(localStorage.getItem(key)||0);
  if(score>best){ best=score; try{ localStorage.setItem(key,String(best)); }catch(e){} }
  bestScore.textContent="Ğ ĞµĞºĞ¾Ñ€Ğ´: "+best;
  finalOverlay.hidden=false;
}

/* ===== Ğ‘ÑƒÑ‚Ğ¾Ğ½Ğ¸ ===== */
document.getElementById("startBtn").onclick=startGame;
document.getElementById("playAgain").onclick=function(){ finalOverlay.hidden=true; startGame(); };
document.getElementById("backHome").onclick=function(){ finalOverlay.hidden=true; startOverlay.hidden=false; };
soundBtn.onclick=function(){ soundOn=!soundOn; soundBtn.textContent=soundOn?"ğŸ”Š":"ğŸ”ˆ"; };
stopBtn.onclick=function(){ endGame(); showFinal(); };
homeBtn.onclick=function(){ endGame(); startOverlay.hidden=false; finalOverlay.hidden=true; };
</script>
</body>
</html>
